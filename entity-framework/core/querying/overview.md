---
title: "どのクエリ動作の EF コア"
author: rowanmiller
ms.author: divega
ms.date: 10/27/2016
ms.assetid: de2e34cd-659b-4cab-b5ed-7a979c6bf120
ms.technology: entity-framework-core
uid: core/querying/overview
ms.openlocfilehash: 7fd2940d559f82016d7a8fc3fdcf3af0d5b8bc8f
ms.sourcegitcommit: 01a75cd483c1943ddd6f82af971f07abde20912e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/27/2017
---
# <a name="how-queries-work"></a>クエリのしくみ

Entity Framework Core では、データベースからデータをクエリする言語統合クエリ (LINQ) を使用します。 LINQ では、派生コンテキストおよびエンティティ クラスに基づいて厳密に型指定のクエリを作成する (C#) (または任意の .NET 言語) を使用することができます。

## <a name="the-life-of-a-query"></a>クエリの有効期間

各クエリを通過するプロセスの高レベルな概要を次に示します。

1. データベース プロバイダーで処理する準備が整っている表現の構築に Entity Framework のコアで LINQ クエリの処理します。
   1. 結果をキャッシュすると、この処理は、クエリが実行されるたびに実行する必要はありません。
2. 結果は、データベース プロバイダーに渡されます
   1. データベース プロバイダーを識別、クエリのどの部分は、データベースで評価されます。
   2. クエリのこの部分は、データベースの特定のクエリ言語 (リレーショナル データベースの SQL の場合など) に変換されます。
   3. 1 つまたは複数のクエリは、データベースと、返される結果セットに送信されます (結果は、エンティティのインスタンスではない、データベースから値を)
3. 結果セット内の各アイテムの
   1. 追跡クエリの場合は、EF はデータ コンテキスト インスタンスに対して変更の追跡ツールで既にエンティティを表すかどうかを確認します。
      * 既存のエンティティが返された場合は、
      * ない場合は、新しいエンティティを作成、変更の追跡をセットアップ、および新しいエンティティが返されます
   2. EF では、データがこのクエリの結果セット内の既存のエンティティを表すかどうかはチェックなしの追跡クエリの場合は、
      * そのため、既存のエンティティが返される場合は<sup>(1)</sup>
      * ない場合、新しいエンティティが作成され、返される

<sup>(1)</sup>追跡クエリを使用していない弱い参照返されたエンティティを追跡します。 同じ id を持つ前の結果がスコープ外に出るし、ガベージ コレクションの実行する場合、は、エンティティの新しいインスタンスを取得可能性があります。

## <a name="when-queries-are-executed"></a>クエリが実行されます。

LINQ 演算子を呼び出すときにクエリのメモリ内表現を構築するだけです。 クエリは結果を消費するときに、データベースにのみ送信されます。

データベースに送信されるクエリになる最も一般的な演算は次のとおりです。
* 結果を反復処理する、`for`ループ
* などの演算子を使用して`ToList`、 `ToArray`、 `Single`、`Count`
* データ バインドを UI にクエリの結果

> [!WARNING]  
> **ユーザー入力を必ず検証:**中の EF は SQL インジェクション攻撃から保護を提供、入力のすべての一般的な検証を実行しません。 したがって場合など、エンティティ プロパティに割り当てられている LINQ クエリで使用される Api に渡される値には、信頼できないソースし、アプリケーション要件に合わせて、適切な検証を実行する必要があります。 これには、動的にクエリを構築するために使用されるユーザー入力が含まれます。 LINQ を使用して、目的の式のみよりも確認する必要があります。 式を構築を構築できる、ユーザー入力を受け付けている場合場合でも。
