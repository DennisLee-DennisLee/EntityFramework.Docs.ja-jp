---
title: Entity Framework 6 のプロバイダー モデル - EF6
author: divega
ms.date: 2018-06-27
ms.assetid: 066832F0-D51B-4655-8BE7-C983C557E0E4
ms.openlocfilehash: 7d9e2f49b9ef59fb63b024646911ec0d8dfcfc60
ms.sourcegitcommit: 0d36e8ff0892b7f034b765b15e041f375f88579a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/09/2018
ms.locfileid: "44251105"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="0f6f0-102">Entity Framework 6 のプロバイダー モデル</span><span class="sxs-lookup"><span data-stu-id="0f6f0-102">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="0f6f0-103">Entity Framework プロバイダー モデルでは、さまざまな種類のデータベース サーバーで使用する Entity Framework を使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-103">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="0f6f0-104">たとえば、EF に EF に Microsoft SQL Server Compact Edition に対して使用を許可する別のプロバイダーにプラグインできるときに、Microsoft SQL Server に対して使用を許可する 1 つのプロバイダーを接続することができます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-104">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="0f6f0-105">認識しています EF6 のプロバイダーが見つかりません、 [Entity Framework プロバイダー](~/ef6/fundamentals/providers/index.md)ページ。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-105">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](~/ef6/fundamentals/providers/index.md) page.</span></span>

<span data-ttu-id="0f6f0-106">特定の変更は、EF がオープン ソース ライセンスに基づいてリリースする EF を許可するプロバイダーと対話する方法に必要でした。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-106">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="0f6f0-107">これらの変更は、プロバイダーの登録のための新しいメカニズムと EF6 のアセンブリに対して EF プロバイダーの再構築が必要です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-107">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="0f6f0-108">再構築</span><span class="sxs-lookup"><span data-stu-id="0f6f0-108">Rebuilding</span></span>

<span data-ttu-id="0f6f0-109">EF6 では、.NET Framework の一部であった以前中核のコードが帯域外の (OOB) のアセンブリとしてようになりました配送されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-109">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="0f6f0-110">EF6 に対してアプリケーションを構築する方法の詳細についてで確認できます、 [EF6 のアプリケーションの更新](~/ef6/what-is-new/upgrading-to-ef6.md)ページ。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-110">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span></span> <span data-ttu-id="0f6f0-111">プロバイダーは、次の手順を使用して再構築する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-111">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="0f6f0-112">プロバイダーの種類の概要</span><span class="sxs-lookup"><span data-stu-id="0f6f0-112">Provider types overview</span></span>

<span data-ttu-id="0f6f0-113">EF プロバイダーは、実際に、これらのサービス (の基本クラス) から拡張または (インターフェイス) を実装する CLR 型で定義されているプロバイダーに固有のサービスのコレクションです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-113">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="0f6f0-114">これらのサービスの 2 つは、基本的なと EF で機能するために必要です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-114">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="0f6f0-115">他のユーザーは省略可能ですし、のみ、特定の機能が必要な場合やこれらのサービスの既定の実装は機能しません、特定のデータベース サーバーを対象となる場合は、実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-115">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

## <a name="fundamental-provider-types"></a><span data-ttu-id="0f6f0-116">基本的なプロバイダーの種類</span><span class="sxs-lookup"><span data-stu-id="0f6f0-116">Fundamental provider types</span></span>

### <a name="dbproviderfactory"></a><span data-ttu-id="0f6f0-117">DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="0f6f0-117">DbProviderFactory</span></span>

<span data-ttu-id="0f6f0-118">派生した型に依存して EF [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx)低レベルのデータベースのすべてのアクセスを実行するためです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-118">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="0f6f0-119">DbProviderFactory が EF の一部ではありませんが、ADO.NET プロバイダーのエントリ ポイントを提供する .NET Framework のクラスまたはアプリケーションによって直接 EF、他の O/RMs によって接続、コマンド、パラメーターのインスタンスを取得して使用する代わりには、他のプロバイダーで ADO.NET の抽象化に依存しない方法です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-119">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="0f6f0-120">DbProviderFactory の詳細についてに記載されて、 [ADO.NET に関する MSDN ドキュメント](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-120">More information about DbProviderFactory an be found in the [MSDN documentation for ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span></span>

### <a name="dbproviderservices"></a><span data-ttu-id="0f6f0-121">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="0f6f0-121">DbProviderServices</span></span>

<span data-ttu-id="0f6f0-122">EF は、EF によって既に ADO.NET プロバイダーによって提供される機能の上に必要な追加機能を提供するため DbProviderServices から派生した型があることに依存します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-122">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="0f6f0-123">以前のバージョンの EF で DbProviderServices クラスは、.NET Framework の一部であったし、System.Data.Common 名前空間が見つかりました。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-123">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="0f6f0-124">このクラスを EF6 以降、EntityFramework.dll の一部になったし、System.Data.Entity.Core.Common 名前空間にあります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-124">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="0f6f0-125">DbProviderServices の実装の基本的な機能の詳細についてはのあります[MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-125">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span></span> <span data-ttu-id="0f6f0-126">ただし、この情報の書き込みの時点では更新されないこと EF6 の概念のほとんどは現在も有効です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-126">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="0f6f0-127">DbProviderServices の SQL Server と SQL Server Compact の実装にチェックインしても、[オープン ソース コードベース](https://github.com/aspnet/EntityFramework6/)おり、その他の実装のための便利な参考として使用できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-127">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://github.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="0f6f0-128">以前のバージョンの EF で DbProviderServices の実装を使用する ADO.NET プロバイダーから直接入手されました。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-128">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="0f6f0-129">これは、IServiceProvider を DbProviderFactory をキャストして、GetService メソッドを呼び出すことで行われました。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-129">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="0f6f0-130">これは、EF のプロバイダーを DbProviderFactory に密結合します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-130">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="0f6f0-131">この結合では、.NET Framework 外に移動される EF がブロックされているし、この密結合を EF6 のために削除されましたが、アプリケーションの構成ファイルで直接、またはコード ベースで DbProviderServices の実装が登録されましたさらに詳しく記載されている構成、_登録 DbProviderServices_以下のセクション。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-131">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

## <a name="additional-services"></a><span data-ttu-id="0f6f0-132">その他のサービス</span><span class="sxs-lookup"><span data-stu-id="0f6f0-132">Additional services</span></span>

<span data-ttu-id="0f6f0-133">上記で説明した基本的なサービスだけでなくも多くの他のサービスが EF によって使用される常に、または場合によってプロバイダーに固有であります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-133">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="0f6f0-134">DbProviderServices の実装が、これらのサービスの既定のプロバイダーに固有の実装を指定することができます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-134">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="0f6f0-135">アプリケーションはこれらのサービスの実装をオーバーライドしたり、DbProviderServices の一種で、既定値が提供されない場合に、実装を提供できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-135">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="0f6f0-136">これはで詳しく説明されている、_追加サービスを解決する_以下のセクション。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-136">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="0f6f0-137">プロバイダーは、プロバイダーを対象にする必要があります追加サービスの種類は、以下に示します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-137">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="0f6f0-138">詳細については、各サービスの種類は、API のドキュメントに記載されています。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-138">More details about each of these service types can be found in the API documentation.</span></span>

### <a name="idbexecutionstrategy"></a><span data-ttu-id="0f6f0-139">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="0f6f0-139">IDbExecutionStrategy</span></span>

<span data-ttu-id="0f6f0-140">これは、オプションのサービスにより、クエリとコマンドは、データベースに対して実行されたときに再試行する場合やその他の動作を実装するプロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-140">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="0f6f0-141">実装が指定されていない場合 EF は単にコマンドを実行し、スローされた例外を伝達します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-141">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="0f6f0-142">SQL Server のこのサービスは、SQL Azure などのクラウド ベースのデータベース サーバーに対して実行したときに特に便利ですが、再試行ポリシーを提供する使用されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-142">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

### <a name="idbconnectionfactory"></a><span data-ttu-id="0f6f0-143">IDbConnectionFactory</span><span class="sxs-lookup"><span data-stu-id="0f6f0-143">IDbConnectionFactory</span></span>

<span data-ttu-id="0f6f0-144">これは、プロバイダーにデータベース名のみが指定されると、規約によって DbConnection オブジェクトを作成することができる省略可能なサービスです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-144">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="0f6f0-145">このサービス DbProviderServices の実装、EF 4.1 以降に存在していたことができますも明示的に設定する構成ファイルまたはコードによって解決できることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-145">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="0f6f0-146">プロバイダーは、既定のプロバイダーとして登録されている場合は、このサービスを解決する機会のみを取得 (を参照してください_既定プロバイダー_以下)、既定の接続ファクトリが設定されていない別の場所。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-146">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

### <a name="dbspatialservices"></a><span data-ttu-id="0f6f0-147">DbSpatialServices</span><span class="sxs-lookup"><span data-stu-id="0f6f0-147">DbSpatialServices</span></span>

<span data-ttu-id="0f6f0-148">これは、geography および geometry 空間型のサポートを追加するプロバイダーを許可するオプションのサービスです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-148">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="0f6f0-149">このサービスの実装は、空間型で EF を使用するアプリケーションの順序で指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-149">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="0f6f0-150">DbSptialServices には、2 つの方法での確認が表示されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-150">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="0f6f0-151">DbProviderInfo オブジェクトを使用して最初に、プロバイダー固有の空間サービスが要求された (不変式が含まれていますとマニフェスト トークン) としてキー。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-151">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="0f6f0-152">第 2 に、DbSpatialServices 要求できるキーを持たない。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-152">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="0f6f0-153">これは、解決するには、"グローバル空間"に使用されるプロバイダー スタンドアロン DbGeography または DbGeometry の種類を作成するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-153">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

### <a name="migrationsqlgenerator"></a><span data-ttu-id="0f6f0-154">MigrationSqlGenerator</span><span class="sxs-lookup"><span data-stu-id="0f6f0-154">MigrationSqlGenerator</span></span>

<span data-ttu-id="0f6f0-155">これは、Code First での作成とデータベース スキーマの変更に使用する SQL の生成に使用される、EF の移行を許可するオプションのサービスです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-155">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="0f6f0-156">移行をサポートするために実装が必要です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-156">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="0f6f0-157">実装が指定されている場合に、または使用データベース初期化子または Database.Create メソッドを使用してデータベースを作成するとき。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-157">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="0f6f0-158">Func < DbConnection、文字列、HistoryContextFactory ></span><span class="sxs-lookup"><span data-stu-id="0f6f0-158">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="0f6f0-159">これは省略可能なサービスであり、プロバイダーに HistoryContext のマッピングを構成できるように、 `__MigrationHistory` EF の移行で使用されるテーブル。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-159">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="0f6f0-160">HistoryContext コードの最初の DbContext であり、名前のテーブルと列マッピングの指定などを変更する通常の fluent API を使用して構成できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-160">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="0f6f0-161">すべてのプロバイダー、EF によって返されるこのサービスの既定の実装は、そのプロバイダーによってすべて既定のテーブルと列のマッピングがサポートされている場合、特定のデータベース サーバーの動作可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-161">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="0f6f0-162">このような場合はこのサービスの実装を提供する、プロバイダーは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-162">In such a case the provider does not need to supply an implementation of this service.</span></span>

### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="0f6f0-163">IDbProviderFactoryResolver</span><span class="sxs-lookup"><span data-stu-id="0f6f0-163">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="0f6f0-164">これは、指定した DbConnection オブジェクトから正しい DbProviderFactory を取得するためのオプションのサービスです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-164">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="0f6f0-165">すべてのプロバイダー、EF によって返されるこのサービスの既定の実装の目的は、すべてのプロバイダーを使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-165">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="0f6f0-166">ただし、.NET 4 で実行するときに、DbProviderFactory が公開されていない場合に 1 つからその DbConnections します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-166">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="0f6f0-167">そのため、EF はいくつかのヒューリスティックを使用して、検索、検索する登録済みのプロバイダー。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-167">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="0f6f0-168">一部のプロバイダーは、これらのヒューリスティックの失敗をこのような状況で、プロバイダーが新しい実装を提供します。 ことができます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-168">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="0f6f0-169">DbProviderServices の登録</span><span class="sxs-lookup"><span data-stu-id="0f6f0-169">Registering DbProviderServices</span></span>

<span data-ttu-id="0f6f0-170">DbProviderServices の実装を使用するは、アプリケーションの構成ファイル (app.config または web.config) またはコード ベースの構成を使用して登録できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-170">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="0f6f0-171">いずれの場合も、登録は、キーとして、プロバイダーの「固定名」を使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-171">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="0f6f0-172">これにより、複数のプロバイダーを登録し、1 つのアプリケーションで使用できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-172">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="0f6f0-173">EF の登録のために使用不変名は、インバリアント ADO.NET プロバイダーの登録と接続文字列に使用される名前と同じです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-173">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="0f6f0-174">たとえば、SQL Server 固定名"System.Data.SqlClient"が使用されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-174">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="0f6f0-175">構成ファイルの登録</span><span class="sxs-lookup"><span data-stu-id="0f6f0-175">Config file registration</span></span>

<span data-ttu-id="0f6f0-176">使用する DbProviderServices の種類は、アプリケーションの構成ファイルの entityFramework セクションのプロバイダーの一覧で、provider 要素として登録されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-176">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="0f6f0-177">例えば:</span><span class="sxs-lookup"><span data-stu-id="0f6f0-177">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="0f6f0-178">_型_文字列を使用する DbProviderServices の実装のアセンブリ修飾型名を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-178">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="0f6f0-179">コード ベースの登録</span><span class="sxs-lookup"><span data-stu-id="0f6f0-179">Code-based registration</span></span>

<span data-ttu-id="0f6f0-180">以降では、EF6 プロバイダー登録することもコードを使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-180">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="0f6f0-181">これにより、アプリケーションの構成ファイルに変更を加えずに使用される、EF のプロバイダー。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-181">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="0f6f0-182">コード ベースの構成を使用するアプリケーション クラスを作成する DbConfiguration」の説明に従って、[コード ベースの構成ドキュメント](http://msdn.com/data/jj680699)します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-182">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](http://msdn.com/data/jj680699).</span></span> <span data-ttu-id="0f6f0-183">DbConfiguration クラスのコンス トラクターでは、EF のプロバイダーを登録する SetProviderServices を呼び出す必要がありますから。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-183">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="0f6f0-184">例えば:</span><span class="sxs-lookup"><span data-stu-id="0f6f0-184">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="0f6f0-185">その他のサービスを解決します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-185">Resolving additional services</span></span>

<span data-ttu-id="0f6f0-186">上記のとおり、_プロバイダーの型の概要_セクション、DbProviderServices クラスが追加サービスを解決することもできます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-186">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="0f6f0-187">DbProviderServices が IDbDependencyResolver を実装し、登録されている各 DbProviderServices タイプが「既定のリゾルバー」として追加するため、可能です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-187">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="0f6f0-188">IDbDpendencyResolver メカニズムがで詳しく説明されている[依存関係の解決](~/ef6/fundamentals/configuring/dependency-resolution.md)します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-188">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](~/ef6/fundamentals/configuring/dependency-resolution.md).</span></span> <span data-ttu-id="0f6f0-189">ただし、プロバイダーの追加サービスを解決するには、この仕様でのすべての概念を理解する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-189">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="0f6f0-190">その他のサービスを解決するのには、プロバイダーの最も一般的な方法を DbProviderServices クラスのコンス トラクター内の各サービスの DbProviderServices.AddDependencyResolver を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-190">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="0f6f0-191">たとえば、SqlProviderServices (SQL Server 用の EF プロバイダー) では、初期化のための次のようなコードがあります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-191">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="0f6f0-192">このコンス トラクターは、次のヘルパー クラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-192">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="0f6f0-193">SingletonDependencyResolver: 単一のサービスを解決する簡単な方法を提供する、同じインスタンスが返されるたびにその GetService が呼び出されるサービスは、します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-193">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="0f6f0-194">一時的なサービスは、オンデマンドで一時的なインスタンスを作成するために使用するシングルトン ファクトリとして多くの場合、登録されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-194">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="0f6f0-195">ExecutionStrategyResolver: リゾルバーを返す IExecutionStrategy 実装に固有です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-195">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="0f6f0-196">DbProviderServices.AddDependencyResolver を使用する代わりに、DbProviderServices.GetService をオーバーライドし、その他のサービスを直接解決することはも。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-196">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="0f6f0-197">EF には、特定の種類、および場合によっては、指定されたキーの定義、サービスが必要がある場合、このメソッドが呼び出すされます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-197">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="0f6f0-198">場合、またはサービスを返すことのオプトアウトする場合は null を返すし、問題を解決する別のクラスを許可する代わりに、メソッドは、サービスを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-198">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="0f6f0-199">既定の接続ファクトリを解決するのには GetService 内のコード例このようなもの。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-199">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="0f6f0-200">登録順序</span><span class="sxs-lookup"><span data-stu-id="0f6f0-200">Registration order</span></span>

<span data-ttu-id="0f6f0-201">アプリケーションの構成ファイルで複数の DbProviderServices の実装が登録されている場合は、記載されている順序でセカンダリ競合回避モジュールとして追加されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-201">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="0f6f0-202">競合回避モジュールは、常に、これには、一覧の最後に、プロバイダーが、他のユーザーの前に依存関係を解決するチャンスを取得することを意味セカンダリ競合回避モジュールのチェーンの先頭に追加されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-202">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="0f6f0-203">(最初は、逆ほとんど感じられることが、一覧から、各プロバイダーを取得し、既存のプロバイダーの上に積み重ねを想像している場合に理にかなって)。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-203">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="0f6f0-204">この順序は、通常は関係ありませんプロバイダー サービスのほとんどはプロバイダー固有とプロバイダー固定名によってキー付きであるため。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-204">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="0f6f0-205">ただし、サービスが付いていませんプロバイダーの不変名またはいくつか他のプロバイダーに固有のキーで、サービスが解決されますこの順序に基づきます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-205">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="0f6f0-206">たとえばに設定されていない場合に明示的に異なる場所にそれ以外の場合、し、既定の接続ファクトリはチェーンの最上位のプロバイダーから提供されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-206">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="0f6f0-207">追加の構成ファイルの登録</span><span class="sxs-lookup"><span data-stu-id="0f6f0-207">Additional config file registrations</span></span>

<span data-ttu-id="0f6f0-208">アプリケーションの構成ファイルで直接の説明に従って追加のプロバイダーのサービスの一部を明示的に登録することになります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-208">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="0f6f0-209">DbProviderServices の実装の GetService メソッドによって返されるものではなく、構成ファイル内にある登録が完了したらこのが使用されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-209">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="0f6f0-210">既定の接続ファクトリを登録します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-210">Registering the default connection factory</span></span>

<span data-ttu-id="0f6f0-211">構成ファイルで SQL Express 接続ファクトリ、または LocalDb 接続ファクトリを登録する自動的に EntityFramework NuGet パッケージを EF5 で起動します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-211">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="0f6f0-212">例えば:</span><span class="sxs-lookup"><span data-stu-id="0f6f0-212">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="0f6f0-213">_型_IDbConnectionFactory を実装する必要があります既定の接続ファクトリのアセンブリ修飾型名です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-213">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="0f6f0-214">プロバイダーの NuGet パッケージがインストールされている場合は、この方法で、既定の接続ファクトリを設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-214">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="0f6f0-215">参照してください_プロバイダー用の NuGet パッケージ_以下。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-215">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="0f6f0-216">EF6 プロバイダーの追加の変更</span><span class="sxs-lookup"><span data-stu-id="0f6f0-216">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="0f6f0-217">空間のプロバイダーの変更</span><span class="sxs-lookup"><span data-stu-id="0f6f0-217">Spatial provider changes</span></span>

<span data-ttu-id="0f6f0-218">空間型をサポートするプロバイダーでは、DbSpatialDataReader から派生したクラスに対して追加のメソッドを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-218">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="0f6f0-219">既定の実装が同期メソッドに委任し、そのため実行されなかった非同期的に、オーバーライドする推奨される既存のメソッドの非同期バージョンを新しいはもあります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-219">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="0f6f0-220">Enumerable.Contains のネイティブ サポート</span><span class="sxs-lookup"><span data-stu-id="0f6f0-220">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="0f6f0-221">EF6 では、新しい式の型での LINQ クエリ Enumerable.Contains の使用に関するパフォーマンス問題に対処に追加された、DbInExpression について説明します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-221">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="0f6f0-222">DbProviderManifest クラスには、新しい仮想メソッドは、プロバイダーが新しい式の型を処理するかどうか、EF によって呼び出され、SupportsInExpression があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-222">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="0f6f0-223">既存のプロバイダーの実装と互換性のため、メソッドは false を返します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-223">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="0f6f0-224">この機能強化のメリットを EF6 プロバイダーは、DbInExpression を処理し、true を返す SupportsInExpression をオーバーライドするコードを追加できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-224">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="0f6f0-225">DbExpressionBuilder.In メソッドを呼び出して DbInExpression のインスタンスを作成できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-225">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="0f6f0-226">DbInExpression インスタンスは、通常、テーブルの列との一致をテストする DbConstantExpression の一覧を表す、dbexpression オブジェクトで構成されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-226">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="0f6f0-227">プロバイダーの NuGet パッケージ</span><span class="sxs-lookup"><span data-stu-id="0f6f0-227">NuGet packages for providers</span></span>

<span data-ttu-id="0f6f0-228">EF6、プロバイダーを使用できるようにする方法の 1 つでは、NuGet パッケージとしてリリースします。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-228">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="0f6f0-229">NuGet パッケージを使用すると、次の利点があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-229">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="0f6f0-230">使いやすい NuGet プロバイダーの登録をアプリケーションの構成ファイルに追加するには</span><span class="sxs-lookup"><span data-stu-id="0f6f0-230">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="0f6f0-231">規則によって行われる接続は、登録済みのプロバイダーを使用するために、既定の接続ファクトリを設定する構成ファイルに追加の変更を行んだことができます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-231">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="0f6f0-232">NuGet を処理できるように、EF6 のプロバイダーは、新しい EF パッケージがリリースされた後でもの作業を続行する必要があります、バインド リダイレクトを追加します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-232">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="0f6f0-233">この例は、EntityFramework.SqlServerCompact パッケージに含まれている、[オープン ソース コードベース](http://github.com/aspnet/entityframework6)します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-233">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](http://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="0f6f0-234">このパッケージは、EF プロバイダー NuGet パッケージを作成するための適切なテンプレートを提供します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-234">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="0f6f0-235">PowerShell コマンド</span><span class="sxs-lookup"><span data-stu-id="0f6f0-235">PowerShell commands</span></span>

<span data-ttu-id="0f6f0-236">EntityFramework NuGet パッケージがインストールされている場合は、プロバイダーのパッケージの非常に便利な 2 つのコマンドを含む PowerShell モジュールを登録します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-236">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="0f6f0-237">追加 EFProvider がターゲット プロジェクトの構成ファイルでプロバイダーの新しいエンティティを追加、登録されているプロバイダーの一覧の最後にあることを確認します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-237">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="0f6f0-238">追加 EFDefaultConnectionFactory いずれか、追加、またはターゲット プロジェクトの構成ファイルで defaultConnectionFactory 登録更新します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-238">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="0f6f0-239">構成ファイルを entityFramework セクションを追加し、必要な場合は、プロバイダーのコレクションを追加する 2 つのコマンドを処理します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-239">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="0f6f0-240">これらのコマンドは、install.ps1 NuGet スクリプトから呼び出すことが目的です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-240">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="0f6f0-241">たとえば、install.ps1 SQL Compact プロバイダーの次のようにします。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-241">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="0f6f0-242">これらのコマンドの詳細については、パッケージ マネージャー コンソール ウィンドウで、get-help を使用して取得できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-242">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="0f6f0-243">プロバイダーのラップ</span><span class="sxs-lookup"><span data-stu-id="0f6f0-243">Wrapping providers</span></span>

<span data-ttu-id="0f6f0-244">折り返しプロバイダーは、既存のプロファイルやトレース機能などの他の機能と拡張プロバイダーをラップする EF または ADO.NET プロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-244">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="0f6f0-245">通常の方法でプロバイダーのラップを登録できますが、詳細は、プロバイダーに関連するサービスの解像度をインターセプトすることで実行時に折り返しプロバイダーをセットアップすると便利です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-245">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="0f6f0-246">これを行うには、静的イベント OnLockingConfiguration DbConfiguration クラスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-246">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="0f6f0-247">OnLockingConfiguration は使用がロックされる前に、EF がからのアプリ ドメインのすべての EF 構成の取得場所を決定した後に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-247">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="0f6f0-248">アプリの起動時に (前に EF を使用すると)、アプリが登録このイベントのイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-248">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="0f6f0-249">(構成ファイルにこのハンドラーを登録するためのサポートの追加を検討していますが、これはまだサポートされていません)。イベント ハンドラーは ReplaceService への呼び出しをラップする必要があるすべてのサービスにください。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-249">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="0f6f0-250">たとえば、IDbConnectionFactory と DbProviderService をラップするには、次のようにハンドラーを登録するか。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-250">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="0f6f0-251">解決され、サービスの解決に使用されたキーと共に折り返す必要があるようになりましたが、サービスは、ハンドラーに渡されます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-251">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="0f6f0-252">ハンドラーはこのサービスをラップし、返されたサービスをラップされたバージョンに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-252">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="0f6f0-253">Ef の DbProviderFactory を解決します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-253">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="0f6f0-254">DbProviderFactory は」の説明に従って、EF で必要な基本的なプロバイダーの種類の 1 つ、_プロバイダーの型の概要_前のセクション。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-254">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="0f6f0-255">既に述べたように、型ではない、EF と登録は通常、EF の構成の一部はありませんが代わりに、machine.config ファイルまたはアプリケーションの構成ファイルにおける通常の ADO.NET プロバイダーの登録。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-255">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="0f6f0-256">この EF に関係なく引き続き使用の標準の依存関係の解決メカニズムの DbProviderFactory を探すときに使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-256">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="0f6f0-257">既定のリゾルバー構成ファイルで、通常の ADO.NET の登録を使用して、これは通常、透過的です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-257">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="0f6f0-258">メカニズムを使用する通常の依存関係の解決のため、IDbDependencyResolver を通常の ADO.NET の登録が行われていない場合でも、DbProviderFactory を解決するのには使用できることを意味します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-258">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="0f6f0-259">この方法で DbProviderFactory を解決するには、いくつかの意味合いがあります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-259">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="0f6f0-260">コード ベースの構成を使用するアプリケーションは、適切な DbProviderFactory を登録するには、その DbConfiguration クラスの呼び出しを追加できます。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-260">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="0f6f0-261">これはしたくない (またはできません) をアプリケーションに特に便利だことをまったくの任意のファイル ベースの構成を使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-261">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="0f6f0-262">サービスがラップすることができますか」の説明に従って、ReplaceService を使用して置き換える、_プロバイダーのラップ_前のセクション</span><span class="sxs-lookup"><span data-stu-id="0f6f0-262">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="0f6f0-263">理論上は、DbProviderServices の実装の DbProviderFactory を解決する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-263">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="0f6f0-264">これらのいずれかの方法について注意する重要な点は、EF によって DbProviderFactory の参照のみが影響します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-264">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="0f6f0-265">その他の EF 以外のコードでは、通常の方法で登録する ADO.NET プロバイダーに期待もと、登録が見つからない場合に失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-265">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="0f6f0-266">このため、通常の ADO.NET の方法で登録する DbProviderFactory の通常お勧めします。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-266">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="0f6f0-267">関連サービス</span><span class="sxs-lookup"><span data-stu-id="0f6f0-267">Related services</span></span>

<span data-ttu-id="0f6f0-268">DbProviderFactory を解決するのには EF を使用する場合、IProviderInvariantName と IDbProviderFactoryResolver サービスも解決される必要があります。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-268">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="0f6f0-269">IProviderInvariantName は、特定の種類の DbProviderFactory のプロバイダーの不変名を判断するために使用するサービスです。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-269">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="0f6f0-270">このサービスの既定の実装では、ADO.NET プロバイダーの登録を使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-270">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="0f6f0-271">つまり、DbProviderFactory が EF によって解決されるため、ADO.NET プロバイダーでは通常の方法で登録されていない場合もあるこのサービスを解決するために必要です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-271">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="0f6f0-272">このサービスの競合回避モジュールが DbConfiguration.SetProviderFactory メソッドを使用する場合を自動的に追加されたことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-272">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="0f6f0-273">」の説明に従って、_プロバイダーの型の概要_上記セクションで、IDbProviderFactoryResolver は指定した DbConnection オブジェクトから正しい DbProviderFactory を取得するために使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-273">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="0f6f0-274">.NET 4 で実行されている場合は、このサービスの既定の実装では、ADO.NET プロバイダーの登録を使用します。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-274">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="0f6f0-275">つまり、DbProviderFactory が EF によって解決されるため、ADO.NET プロバイダーでは通常の方法で登録されていない場合もあるこのサービスを解決するために必要です。</span><span class="sxs-lookup"><span data-stu-id="0f6f0-275">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
