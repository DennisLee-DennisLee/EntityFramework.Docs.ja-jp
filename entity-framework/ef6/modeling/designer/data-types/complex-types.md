---
title: EF6 の複合型-の EF デザイナー
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: 9a8228ef-acfd-4575-860d-769d2c0e18a1
caps.latest.revision: 3
ms.openlocfilehash: 6d0744921085afdafa35d137d276c54738cdd465
ms.sourcegitcommit: f05e7b62584cf228f17390bb086a61d505712e1b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/08/2018
ms.locfileid: "39122276"
---
# <a name="complex-types---ef-designer"></a>複合型の EF デザイナー
このトピックでは、Entity Framework デザイナー (EF Designer) を含む複合型にマップする方法と複合型のプロパティを含むエンティティを照会する方法を示します。

次の図は、EF Designer を使用する場合に使用される主なウィンドウを示します。

![EFDesigner](~/ef6/media/efdesigner.png)

> [!NOTE]
> 概念モデルをビルドすると、エラー一覧にマップされていないエンティティとアソシエーションに関する警告があります。 エラーが解消されますモデルからデータベースを生成することを選択した後ために、これらの警告を無視できます。

## <a name="what-is-a-complex-type"></a>複合型とは

複合型はエンティティ型の非スカラー プロパティで、これによってスカラー プロパティをエンティティ内で整理できます。 エンティティと同様に、複合型はスカラー プロパティまたは他の複合型プロパティで構成されています。

複合型を表すオブジェクトを使用する場合は、次の注意。

-   複合型では、キーがないとは独立して存在できないためです。 複合型は、エンティティ型またはその他の複合型のプロパティとしてのみ存在できます。
-   複合型のアソシエーションに参加できませんし、ナビゲーション プロパティを含めることはできません。
-   複合型プロパティにすることはできません**null**します。 * * InvalidOperationException * * が発生したときに**DbContext.SaveChanges**と呼びます null の複雑なオブジェクトが検出されたとします。 複雑なオブジェクトのスカラー プロパティは、 **null**します。
-   複合型は他の複合型を継承できません。
-   として複合型を定義する必要があります、**クラス**します。 
-   EF は、複合型オブジェクトのメンバーに対する変更を検出したときに**DbContext.DetectChanges**が呼び出されます。 エンティティ フレームワーク**DetectChanges** 、次のメンバーが呼び出されたときに自動的に: **DbSet.Find**、 **DbSet.Local**、 **DbSet.Remove**、 **DbSet.Add**、 **DbSet.Attach**、 **DbContext.SaveChanges**、 **DbContext.GetValidationErrors**、**DbContext.Entry**、 **DbChangeTracker.Entries**します。

## <a name="refactor-an-entitys-properties-into-new-complex-type"></a>新しい複合型へのエンティティのプロパティをリファクタリングします。

概念モデルのエンティティが既にある場合、プロパティの一部の複合型プロパティにリファクタリングしたい場合があります。

デザイナーの画面に 1 つを選択するか、エンティティの他のプロパティ (ナビゲーション プロパティを除く) を右クリックし、選択**リファクター -&gt;新しい複合型に移動**します。

![リファクター](~/ef6/media/refactor.png)

選択したプロパティを持つ新しい複合型を追加、**モデル ブラウザー**します。 複合型には既定の名前が付きます。

新しく作成した型の複合プロパティが、選択したプロパティと置き換わります。 プロパティのマッピングはすべて保持されます。

![Refactor2](~/ef6/media/refactor2.png)

## <a name="create-a-new-complex-type"></a>新しい複合型を作成します。

既存のエンティティのプロパティを含まない新しい複合型を作成することもできます。

右クリックし、**複合型**フォルダーをポイントする、モデル ブラウザーで**AddNew 複合型...**。 または、選択、**複合型**フォルダーとキーを押して、**挿入**キーボードのキー。

![AddNewComplextype](~/ef6/media/addnewcomplextype.png)

既定の名前を持つ新しい複合型がフォルダーに追加されます。 型にプロパティを追加できます。

## <a name="add-properties-to-a-complex-type"></a>複合型にプロパティを追加します。

複合型のプロパティはスカラー型か既存の複合型にすることができます。 ただし、複合型のプロパティに循環参照を含めることはできません。 たとえば、複合型**OnsiteCourseDetails**複合型のプロパティを含めることはできません**OnsiteCourseDetails**します。

以下のいずれかの方法で、複合型にプロパティを追加できます。

-   モデル ブラウザーで複合型を右クリックし、**追加**、順にポイント**スカラー プロパティ**または**複合プロパティ**、必要なプロパティの型を選択します。 または、複合型を選択し、キーを押します、**挿入**キーボードのキー。  

    ![AddPropertiestoComplexType](~/ef6/media/addpropertiestocomplextype.png)

    既定の名前を持つ新しいプロパティが複合型に追加されます。

- または

-   エンティティ プロパティを右クリックし、 **EF Designer**サーフェスを選択します**コピー**で複合型を右クリックし、**モデル ブラウザー**選択**貼り付け**します。

## <a name="rename-a-complex-type"></a>複合型の名前を変更します。

複合型の名前を変更すると、その型へのすべての参照がプロジェクト全体で更新されます。

-   緩やかに変化で複合型をダブルクリックして、**モデル ブラウザー**します。
    名前が選択され、編集モードになります。

- または

-   複合型を右クリックし、**モデル ブラウザー**選択と**の名前を変更**。

- または

-   モデル ブラウザーで複合型を選択し、F2 キーを押します。

- または

-   複合型を右クリックし、**モデル ブラウザー**選択**プロパティ**。 内の名前を編集、**プロパティ**ウィンドウ。

## <a name="add-an-existing-complex-type-to-an-entity-and-map-its-properties-to-table-columns"></a>既存の複合型をエンティティに追加し、そのプロパティをテーブルの列にマップ

1.  エンティティを右クリックし、 をポイント**新規追加**、選び**複合プロパティ**します。
    既定の名前を持つ複合型プロパティがエンティティに追加されます。 既存の複合型から選択した既定の型がプロパティに割り当てられます。
2.  目的の種類のプロパティを割り当てる、**プロパティ**ウィンドウ。
    複合型プロパティをエンティティに追加した後、そのプロパティをテーブル列にマップする必要があります。
3.  デザイン画面またはエンティティ型を右クリックし、**モデル ブラウザー**選択**テーブル マッピング**します。
    テーブル マッピングが表示されます、**マッピングの詳細**ウィンドウ。
4.  展開、**マップ&lt;テーブル名&gt;** ノード。
    A**列マッピング**ノードが表示されます。
5.  展開、**列マッピング**ノード。
    テーブル内のすべての列の一覧が表示されます。 既定のプロパティ (あれば) 列がマップされるには下に表示、**値/プロパティ**見出し。
6.  マップする列を選択し、対応するを右クリックし、**値/プロパティ**フィールド。
    すべてのスカラー プロパティのドロップダウン リストが表示されます。
7.  適切なプロパティを選択します。

    ![MapComplexType](~/ef6/media/mapcomplextype.png)

8.  各テーブル列ごとに、手順 6. と 7. を繰り返します。

>[!NOTE]
> 列マッピングを削除する をクリックし、マップする列を選択、**値/プロパティ**フィールド。 次に、選択**削除**ドロップダウン リストから。

## <a name="map-a-function-import-to-a-complex-type"></a>関数インポートを複合型にマップします。

関数インポートは、ストアド プロシージャに基づいています。 関数インポートを複合型にマップするには、対応するストアド プロシージャが返す列の数が複合型のプロパティの数と一致するようにし、ストレージ型がプロパティ型と互換性があるようにする必要があります。

-   複合型にマップするインポートした関数をダブルクリックします。

    ![FunctionImports](~/ef6/media/functionimports.png)

-   新しい関数インポートの設定を、次のように入力します。
    -   関数インポートを作成するストアド プロシージャの指定、**ストアド プロシージャ名**フィールド。 このフィールドは、ストレージ モデル内のすべてのストアド プロシージャが表示されるドロップダウン リストです。
    -   関数インポートの名前を指定、**関数インポート名**フィールド。
    -   選択**複雑な**戻り値として入力し、ドロップダウン リストから適切な種類を選択して特定の複雑な戻り値の型を指定します。

        ![EditFunctionImport](~/ef6/media/editfunctionimport.png)

-   **[OK]** をクリックします。
    関数インポート エントリが概念モデルに作成されます。

### <a name="customize-column-mapping-for-function-import"></a>列の関数インポート マッピングのカスタマイズします。

-   モデル ブラウザーで関数インポートを右クリックして**関数インポート マッピング**します。
    **マッピングの詳細**ウィンドウが表示され、関数インポートの既定のマッピングを表示します。 矢印は、列の値とプロパティの値の間のマッピングを示します。 既定では、列名は、複合型のプロパティ名と同じであるものとされます。 既定の列名は、グレーのテキストで表示されます。
-   必要に応じて、関数インポートに対応するストアド プロシージャにより返される列名と一致するように、列名を変更します。

## <a name="delete-a-complex-type"></a>複合型を削除します。

複合型を削除すると、概念モデルからその型が削除され、その型のすべてのインスタンスのマッピングが削除されます。 ただし、その型への参照は更新されません。 たとえば、エンティティに型 ComplexType1 の複合型プロパティがあるしで ComplexType1 が削除された場合、**モデル ブラウザー**、対応するエンティティ プロパティは更新されません。 削除された複合型を参照するエンティティが含まれているために、モデルは検証されません。 エンティティ デザイナーを使用すると、削除された複合型への参照を更新または削除できます。

-   モデル ブラウザーで複合型を右クリックして**削除**します。

- または

-   モデル ブラウザーで複合型を選択し、キーボードの Del キーを押します。

## <a name="query-for-entities-containing-properties-of-complex-type"></a>複合型のプロパティを含むエンティティのクエリ

次のコードでは、複合型プロパティが含まれている型のオブジェクトのエンティティのコレクションを返すクエリを実行する方法を示します。

``` csharp
    using (SchoolEntities context = new SchoolEntities())
    {
        var courses =
            from c in context.OnsiteCourses
            order by c.Details.Time
            select c;

        foreach (var c in courses)
        {
            Console.WriteLine("Time: " + c.Details.Time);
            Console.WriteLine("Days: " + c.Details.Days);
            Console.WriteLine("Location: " + c.Details.Location);
        }
    }
```
