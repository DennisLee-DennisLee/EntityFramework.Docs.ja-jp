---
title: Migrate.exe - EF6 を使用します。
author: divega
ms.date: 10/23/2016
ms.assetid: 989ea862-e936-4c85-926a-8cfbef5df5b8
ms.openlocfilehash: cf6c3a0a256730b24addf1012d6ff53b17035cd4
ms.sourcegitcommit: c568d33214fc25c76e02c8529a29da7a356b37b4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/30/2018
ms.locfileid: "47459540"
---
# <a name="using-migrateexe"></a><span data-ttu-id="7e193-102">Migrate.exe を使用します。</span><span class="sxs-lookup"><span data-stu-id="7e193-102">Using migrate.exe</span></span>
<span data-ttu-id="7e193-103">Code First Migrations を使用してからデータベースを更新すること、visual studio 内でコマンド ライン ツールの migrate.exe 経由で実行することもできますが、します。</span><span class="sxs-lookup"><span data-stu-id="7e193-103">Code First Migrations can be used to update a database from inside visual studio, but can also be executed via the command line tool migrate.exe.</span></span> <span data-ttu-id="7e193-104">このページ migrate.exe を使用して、データベースに対して移行を実行する方法の概要を簡単になります。</span><span class="sxs-lookup"><span data-stu-id="7e193-104">This page will give a quick overview on how to use migrate.exe to execute migrations against a database.</span></span>

> [!NOTE]
> <span data-ttu-id="7e193-105">この記事では、基本的なシナリオで Code First Migrations を使用する方法を理解する前提としています。</span><span class="sxs-lookup"><span data-stu-id="7e193-105">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="7e193-106">そうしないかどうかを読み取る必要があります[Code First Migrations](~/ef6/modeling/code-first/migrations/index.md)続行する前にします。</span><span class="sxs-lookup"><span data-stu-id="7e193-106">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="copy-migrateexe"></a><span data-ttu-id="7e193-107">コピー migrate.exe</span><span class="sxs-lookup"><span data-stu-id="7e193-107">Copy migrate.exe</span></span>

<span data-ttu-id="7e193-108">Entity Framework をインストールするときに NuGet を使用してこの migrate.exe はダウンロードしたパッケージの [ツール] フォルダー内になります。</span><span class="sxs-lookup"><span data-stu-id="7e193-108">When you install Entity Framework using NuGet migrate.exe will be inside the tools folder of the downloaded package.</span></span> <span data-ttu-id="7e193-109">&lt;プロジェクト フォルダー&gt;\\パッケージ\\EntityFramework&lt; 。バージョン&gt;\\ツール</span><span class="sxs-lookup"><span data-stu-id="7e193-109">In &lt;project folder&gt;\\packages\\EntityFramework.&lt;version&gt;\\tools</span></span>

<span data-ttu-id="7e193-110">Migrate.exe をした後は、移行を含むアセンブリの場所にコピーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e193-110">Once you have migrate.exe then you need to copy it to the location of the assembly that contains your migrations.</span></span>

<span data-ttu-id="7e193-111">アプリケーションが .NET 4 を対象し、しない 4.5 し、コピーする必要が場合、 **Redirect.config**の場所にし名前を変更して**migrate.exe.config**します。これは、migrate.exe Entity Framework のアセンブリを検索できる正しいバインド リダイレクトを取得するようにします。</span><span class="sxs-lookup"><span data-stu-id="7e193-111">If your application targets .NET 4, and not 4.5, then you will need to copy the **Redirect.config** into the location as well and rename it **migrate.exe.config**. This is so that migrate.exe gets the correct binding redirects to be able to locate the Entity Framework assembly.</span></span>

| <span data-ttu-id="7e193-112">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="7e193-112">.NET 4.5</span></span>                                      | <span data-ttu-id="7e193-113">.NET 4.0</span><span class="sxs-lookup"><span data-stu-id="7e193-113">.NET 4.0</span></span>                                      |
|:----------------------------------------------|:----------------------------------------------|
| ![.NET 4.5 ファイル](~/ef6/media/net45files.png) | ![.NET 4.0 のファイル](~/ef6/media/net40files.png) |

> [!NOTE]
> <span data-ttu-id="7e193-116">x64 をサポートしていない migrate.exe アセンブリ。</span><span class="sxs-lookup"><span data-stu-id="7e193-116">migrate.exe doesn't support x64 assemblies.</span></span>

<span data-ttu-id="7e193-117">移動すると migrate.exe 正しいフォルダーに、データベースに対して移行の実行に使用できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e193-117">Once you have moved migrate.exe to the correct folder then you should be able to use it to execute migrations against the database.</span></span> <span data-ttu-id="7e193-118">ユーティリティが実行するように設計は、移行を実行するだけです。</span><span class="sxs-lookup"><span data-stu-id="7e193-118">All the utility is designed to do is execute migrations.</span></span> <span data-ttu-id="7e193-119">移行を生成または SQL スクリプトを作成できません。</span><span class="sxs-lookup"><span data-stu-id="7e193-119">It cannot generate migrations or create a SQL script.</span></span>

## <a name="see-options"></a><span data-ttu-id="7e193-120">オプションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="7e193-120">See options</span></span>

``` console
Migrate.exe /?
```

<span data-ttu-id="7e193-121">上記はこのユーティリティでは、これが機能するために migrate.exe を実行しているのと同じ場所で、EntityFramework.dll する必要がありますに注意してくださいに関連付けられているヘルプ ページを表示します。</span><span class="sxs-lookup"><span data-stu-id="7e193-121">The above will display the help page associated with this utility, note that you will need to have the EntityFramework.dll in the same location that you are running migrate.exe in order for this to work.</span></span>

## <a name="migrate-to-the-latest-migration"></a><span data-ttu-id="7e193-122">最新の移行への移行します。</span><span class="sxs-lookup"><span data-stu-id="7e193-122">Migrate to the latest migration</span></span>

``` console
Migrate.exe MyMvcApplication.dll /startupConfigurationFile=”..\\web.config”
```

<span data-ttu-id="7e193-123">構成ファイルを指定しない場合と migrate.exe に唯一の必須のパラメーターを実行することは、これを実行しようとしている移行を含むアセンブリには、アセンブリが、すべての規則が使用されますベースの設定をします。</span><span class="sxs-lookup"><span data-stu-id="7e193-123">When running migrate.exe the only mandatory parameter is the assembly, which is the assembly that contains the migrations that you are trying to run, but it will use all convention based settings if you do not specify the configuration file.</span></span>

## <a name="migrate-to-a-specific-migration"></a><span data-ttu-id="7e193-124">特定の移行への移行します。</span><span class="sxs-lookup"><span data-stu-id="7e193-124">Migrate to a specific migration</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile=”MyApp.exe.config” /targetMigration=”AddTitle”
```

<span data-ttu-id="7e193-125">特定の移行までの移行を実行する場合は、移行の名前を指定できます。</span><span class="sxs-lookup"><span data-stu-id="7e193-125">If you want to run migrations up to a specific migration, then you can specify the name of the migration.</span></span> <span data-ttu-id="7e193-126">これには、必要に応じて以前のすべての移行は実行まで、指定された移行を取得します。</span><span class="sxs-lookup"><span data-stu-id="7e193-126">This will run all previous migrations as required until getting to the migration specified.</span></span>

## <a name="specify-working-directory"></a><span data-ttu-id="7e193-127">作業ディレクトリを指定します。</span><span class="sxs-lookup"><span data-stu-id="7e193-127">Specify working directory</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile=”MyApp.exe.config” /startupDirectory=”c:\\MyApp”
```

<span data-ttu-id="7e193-128">アセンブリが依存関係を持っているか、作業ディレクトリに対して相対的なファイルを読み取る場合は、startupDirectory を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e193-128">If you assembly has dependencies or reads files relative to the working directory then you will need to set startupDirectory.</span></span>

## <a name="specify-migration-configuration-to-use"></a><span data-ttu-id="7e193-129">使用する移行の構成を指定します。</span><span class="sxs-lookup"><span data-stu-id="7e193-129">Specify migration configuration to use</span></span>

``` console
Migrate.exe MyAssembly CustomConfig /startupConfigurationFile=”..\\web.config”
```

<span data-ttu-id="7e193-130">移行構成の複数のクラスがあれば、DbMigrationConfiguration から継承するクラスを指定する必要はこの実行に使用します。</span><span class="sxs-lookup"><span data-stu-id="7e193-130">If you have multiple migration configuration classes, classes inheriting from DbMigrationConfiguration, then you need to specify which is to be used for this execution.</span></span> <span data-ttu-id="7e193-131">これは、省略可能な 2 番目のパラメーターとして上のスイッチを使用せずに提供することによって指定されます。</span><span class="sxs-lookup"><span data-stu-id="7e193-131">This is specified by providing the optional second parameter without a switch as above.</span></span>

## <a name="provide-connection-string"></a><span data-ttu-id="7e193-132">接続文字列を指定します。</span><span class="sxs-lookup"><span data-stu-id="7e193-132">Provide connection string</span></span>

``` console
Migrate.exe BlogDemo.dll /connectionString=”Data Source=localhost;Initial Catalog=BlogDemo;Integrated Security=SSPI” /connectionProviderName=”System.Data.SqlClient”
```

<span data-ttu-id="7e193-133">コマンドラインでの接続文字列を指定する場合は、プロバイダー名も指定してください。</span><span class="sxs-lookup"><span data-stu-id="7e193-133">If you wish to specify a connection string at the command line then you must also provide the provider name.</span></span> <span data-ttu-id="7e193-134">プロバイダー名を指定しないと、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="7e193-134">Not specifying the provider name will cause an exception.</span></span>

## <a name="common-problems"></a><span data-ttu-id="7e193-135">一般的な問題</span><span class="sxs-lookup"><span data-stu-id="7e193-135">Common Problems</span></span>

| <span data-ttu-id="7e193-136">エラー メッセージ</span><span class="sxs-lookup"><span data-stu-id="7e193-136">Error Message</span></span>                                                                                                                                                                                                                                                                                                                      | <span data-ttu-id="7e193-137">ソリューション</span><span class="sxs-lookup"><span data-stu-id="7e193-137">Solution</span></span>                                                                                                                                                                                                                                                                                             |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7e193-138">未処理の例外: System.IO.FileLoadException: ファイルまたはアセンブリを読み込むことができません ' EntityFramework、バージョン, culture = neutral, PublicKeyToken = b77a5c561934e089' またはその依存関係の 1 つ。</span><span class="sxs-lookup"><span data-stu-id="7e193-138">Unhandled Exception: System.IO.FileLoadException:  Could not load file or assembly 'EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="7e193-139">指定したアセンブリのマニフェスト定義では、アセンブリ参照は一致しません。</span><span class="sxs-lookup"><span data-stu-id="7e193-139">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="7e193-140">(HRESULT からの例外: 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="7e193-140">(Exception from HRESULT: 0x80131040)</span></span>         | <span data-ttu-id="7e193-141">通常、つまり、Redirect.config ファイルを使用せず、.NET 4 アプリケーションを実行していること。</span><span class="sxs-lookup"><span data-stu-id="7e193-141">This typically means that you are running a .NET 4 application without the Redirect.config file.</span></span> <span data-ttu-id="7e193-142">Redirect.config を migrate.exe と同じ場所にコピーして migrate.exe.config に名前を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e193-142">You need to copy the Redirect.config to the same location as migrate.exe and rename it to migrate.exe.config.</span></span>                                                                                       |
| <span data-ttu-id="7e193-143">未処理の例外: System.IO.FileLoadException: ファイルまたはアセンブリを読み込むことができません ' EntityFramework、バージョン 4.4.0.0、カルチャを = = neutral, PublicKeyToken = b77a5c561934e089' またはその依存関係の 1 つ。</span><span class="sxs-lookup"><span data-stu-id="7e193-143">Unhandled Exception: System.IO.FileLoadException: Could not load file or assembly 'EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="7e193-144">指定したアセンブリのマニフェスト定義では、アセンブリ参照は一致しません。</span><span class="sxs-lookup"><span data-stu-id="7e193-144">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="7e193-145">(HRESULT からの例外: 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="7e193-145">(Exception from HRESULT: 0x80131040)</span></span>          | <span data-ttu-id="7e193-146">この例外は、.NET 4.5 が migrate.exe 場所にコピーされます、Redirect.config でアプリケーションを実行していることを意味します。</span><span class="sxs-lookup"><span data-stu-id="7e193-146">This exception means that you are running a .NET 4.5 application with the Redirect.config copied to the migrate.exe location.</span></span> <span data-ttu-id="7e193-147">アプリが .NET 4.5 の場合は、構成ファイル内でリダイレクトする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7e193-147">If your app is .NET 4.5 then you do not need to have the config file with the redirects inside.</span></span> <span data-ttu-id="7e193-148">Migrate.exe.config ファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="7e193-148">Delete the migrate.exe.config file.</span></span>                                    |
| <span data-ttu-id="7e193-149">エラー: 保留中の変更があるし、自動移行が無効になっているため、現在のモデルに合わせてデータベースを更新できません。</span><span class="sxs-lookup"><span data-stu-id="7e193-149">ERROR: Unable to update database to match the current model because there are pending changes and automatic migration is disabled.</span></span> <span data-ttu-id="7e193-150">コード ベースの移行を保留中のモデルの変更を書き込むか、自動移行を有効にします。</span><span class="sxs-lookup"><span data-stu-id="7e193-150">Either write the pending model changes to a code-based migration or enable automatic migration.</span></span> <span data-ttu-id="7e193-151">自動移行の有効化する場合は true を DbMigrationsConfiguration.AutomaticMigrationsEnabled を設定します。</span><span class="sxs-lookup"><span data-stu-id="7e193-151">Set DbMigrationsConfiguration.AutomaticMigrationsEnabled to true to enable automatic migration.</span></span> | <span data-ttu-id="7e193-152">このエラーは、実行されている移行、モデルに加えられた変更に対処するための移行を作成するいないし、データベースが、モデルと一致しない場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="7e193-152">This error occurs if running migrate when you haven’t created a migration to cope with changes made to the model, and the database does not match the model.</span></span> <span data-ttu-id="7e193-153">データベースをアップグレードへの移行を作成せず migrate.exe を実行し、モデル クラスにプロパティを追加するこの例に示します。</span><span class="sxs-lookup"><span data-stu-id="7e193-153">Adding a property to a model class then running migrate.exe without creating a migration to upgrade the database is an example of this.</span></span> |
| <span data-ttu-id="7e193-154">エラー: メンバーの型は解決されません ' System.Data.Entity.Migrations.Design.ToolingFacade+UpdateRunner,EntityFramework、バージョン, culture = neutral, PublicKeyToken = b77a5c561934e089'。</span><span class="sxs-lookup"><span data-stu-id="7e193-154">ERROR: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+UpdateRunner,EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.</span></span>                                                                                                                                       | <span data-ttu-id="7e193-155">このエラーは、不適切なスタートアップ ディレクトリを指定することによって発生することができます。</span><span class="sxs-lookup"><span data-stu-id="7e193-155">This error can be caused by specifying an incorrect startup directory.</span></span> <span data-ttu-id="7e193-156">Migrate.exe の場所があります。</span><span class="sxs-lookup"><span data-stu-id="7e193-156">This must be the location of migrate.exe</span></span>                                                                                                                                                                                      |
| <span data-ttu-id="7e193-157">未処理の例外: System.NullReferenceException: オブジェクト参照がオブジェクトのインスタンスに設定されていません。</span><span class="sxs-lookup"><span data-stu-id="7e193-157">Unhandled Exception: System.NullReferenceException: Object reference not set to an instance of an object.</span></span> <br/>   <span data-ttu-id="7e193-158">System.Data.Entity.Migrations.Console.Program.Main (string[] args) に</span><span class="sxs-lookup"><span data-stu-id="7e193-158">at System.Data.Entity.Migrations.Console.Program.Main(String[] args)</span></span>                                                                                                                                             | <span data-ttu-id="7e193-159">これは、使用しているシナリオに必要なパラメーターを指定しないことにより発生できます。</span><span class="sxs-lookup"><span data-stu-id="7e193-159">This can be caused by not specifying a required parameter for a scenario that you are using.</span></span> <span data-ttu-id="7e193-160">たとえば、プロバイダー名を指定せず、接続文字列を指定します。</span><span class="sxs-lookup"><span data-stu-id="7e193-160">For example specifying a connection string without specifying the provider name.</span></span>                                                                                                                        |
| <span data-ttu-id="7e193-161">エラー: 'ClassLibrary1' アセンブリには、複数の移行の構成の種類が見つかりました。</span><span class="sxs-lookup"><span data-stu-id="7e193-161">ERROR: More than one migrations configuration type was found in the assembly 'ClassLibrary1'.</span></span> <span data-ttu-id="7e193-162">使用する 1 つの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="7e193-162">Specify the name of the one to use.</span></span>                                                                                                                                                                                                  | <span data-ttu-id="7e193-163">1 つ以上の構成クラスが、エラーが示すよう、指定したアセンブリであります。</span><span class="sxs-lookup"><span data-stu-id="7e193-163">As the error states, there is more than one configuration class in the given assembly.</span></span> <span data-ttu-id="7e193-164">/ConfigurationType スイッチを使用して、利用するかを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e193-164">You must use the /configurationType switch to specify which to use.</span></span>                                                                                                                                           |
| <span data-ttu-id="7e193-165">エラー: ファイルまたはアセンブリに読み込むことができません '&lt;assemblyName&gt;' またはその依存関係の 1 つ。</span><span class="sxs-lookup"><span data-stu-id="7e193-165">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;’ or one of its dependencies.</span></span> <span data-ttu-id="7e193-166">指定したアセンブリ名またはコードベースが無効です。</span><span class="sxs-lookup"><span data-stu-id="7e193-166">The given assembly name or codebase was invalid.</span></span> <span data-ttu-id="7e193-167">(HRESULT からの例外: 0x80131047)</span><span class="sxs-lookup"><span data-stu-id="7e193-167">(Exception from HRESULT: 0x80131047)</span></span>                                                                                                                                                    | <span data-ttu-id="7e193-168">アセンブリ名の指定でない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7e193-168">This can be caused by specifying an assembly name incorrectly or not having</span></span>                                                                                                                                                                                                                          |
| <span data-ttu-id="7e193-169">エラー: ファイルまたはアセンブリに読み込むことができません '&lt;assemblyName&gt;' またはその依存関係の 1 つ。</span><span class="sxs-lookup"><span data-stu-id="7e193-169">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;' or one of its dependencies.</span></span> <span data-ttu-id="7e193-170">正しくない形式のプログラムを読み込もうとしました。</span><span class="sxs-lookup"><span data-stu-id="7e193-170">An attempt was made to load a program with an incorrect format.</span></span>                                                                                                                                                                          | <span data-ttu-id="7e193-171">これは、x64 に対して migrate.exe を実行しようとしている場合アプリケーション。</span><span class="sxs-lookup"><span data-stu-id="7e193-171">This happens if you are trying to run migrate.exe against an x64 application.</span></span> <span data-ttu-id="7e193-172">EF 5.0 上下 x86 上でのみ機能します。</span><span class="sxs-lookup"><span data-stu-id="7e193-172">EF 5.0 and below will only work on x86.</span></span>                                                                                                                                                                                |
